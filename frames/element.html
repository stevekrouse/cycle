<head>
  <script src="../vendor/blockly/blockly-compressed-dirty-modified.js"></script>
  <script src="../vendor/blockly/blocks_compressed.js"></script>
  <script src="../vendor/blockly/en.js"></script>
  
  <script src="../blocks/element/blocks.js"></script>
  <script src="../blocks/element/generator.js"></script>
  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
</head>
<body>
  <div id="elementBlocks" style="height: 100%" ></div>
  
  <xml id="toolbox" style="display: none;">
    <block type="colour_picker">
      <field name="COLOUR">#ff0000</field>
    </block>
    <block type="text">
      <field name="TEXT"></field>
    </block>
    <block type="text_join">
      <mutation items="2"></mutation>
    </block>
    <block type="colour_random"></block>
    <block type="colour_rgb">
      <value name="RED">
        <shadow type="math_number">
          <field name="NUM">100</field>
        </shadow>
      </value>
      <value name="GREEN">
        <shadow type="math_number">
          <field name="NUM">50</field>
        </shadow>
      </value>
      <value name="BLUE">
        <shadow type="math_number">
          <field name="NUM">0</field>
        </shadow>
      </value>
    </block>
    <block type="cycle_container"></block>
    <block type="cycle_button"></block>
    <block type="cycle_text"></block>
    <!--image-->
    <!--text input-->
    <!--list-->
    <!--list element (numbered?)-->
    <!--link-->
    <!--heading-->
    
    <!--text area-->
    <!--table-->
    <!--table row-->
    <!--table cell-->
    <!--code (pre)-->
    <!--embed-->
    <!--spacer-->
    <!--radio buttons-->
    <!--checkboxes-->
    <!--select dropdown-->
    <!--toggle-->
    <!--navbar-->
  </xml>
  
  <xml id="elementStartingBlocks">
    <block type="cycle_page" deletable="false" movable="false" x="0" y="10"></block>
  </xml>
    
  <script>
    Blockly.BlockSvg.START_HAT = true;
  
    elementWorkspace = Blockly.inject('elementBlocks',  { 
    	toolbox : document.getElementById("toolbox"), 
    	collapse : true, 
    	comments : true, 
    	disable : true, 
    	maxBlocks : Infinity, 
    	trashcan : true, 
    	horizontalLayout : false, 
    	toolboxPosition : 'start', 
    	css : true, 
    	media : '../vendor/blockly/media/', 
    	rtl : false, 
    	scrollbars : true, 
    	sounds : true, 
    	oneBasedIndex : true
    });
    
    Blockly.Xml.domToWorkspace(elementWorkspace, document.getElementById('elementStartingBlocks'));
    
    elementWorkspace.addChangeListener(function() {window.parent.$('body').trigger('elementChange') })
    
    // selected block
    // setInterval(function(){
    //   if (Blockly.selected) {
        
    //   } else if (!window.currentlySelectedBlockId || !blockById(elementWorkspace.getTopBlocks(true)[0], window.currentlySelectedBlockId)) {
    //     window.currentlySelectedBlockId = elementWorkspace.getTopBlocks(true)[0].id
    //   }
    //   blockById(elementWorkspace.getTopBlocks(true)[0], window.currentlySelectedBlockId).select()
    // }, 100)

    
  
  
  window.currentlySelectedBlockId = undefined
  function getElementCode() {
    blocks = elementWorkspace.getTopBlocks(true);
    return elementWorkSpaceData(blocks[0])
  }
  
  
  function blockById(block, id){
    if (!block){
      return null
    } else if (block.id == id){
      return block
    } else {
      return blockById(block.getNextBlock(), id)
    }
  }
  
  
  </script>
</body>
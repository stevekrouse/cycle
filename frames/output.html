<script type="text/javascript" src="https://unpkg.com/vue/dist/vue.js"></script>
<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<body>
  <div id="page"></div>
</body>
<script>
  window.loads = []
  function scopeVaribles(funcString, keyword, variables) {
    var result = funcString
    variables.forEach(function(variable) {
      result = result.split(variable).join(keyword + "." + variable)
    })
    return result
  }
  
  function parseCodeToVueRender(code, variables){
    return function(h) {
      return parseChildrenToRender(this, h, code, variables)
    }
  }
  function parseChildrenToRender(self, h, code, variables){
    if (code == null) {
      return null 
    } else if (typeof code == "string") {
      return eval(scopeVaribles(code, "self", variables))  // TODO generalize for other variables
    } else {
      return h(
        code.tagType,
        scopeEvents(code.attributes, self, variables),
        code.children.map(function(child) {
          return parseChildrenToRender(self, h, child, variables)
        })
      )
    }
  }
  function scopeEvents(attributes, self, variables){
    var on = attributes.on || {}
    var onKeys = Object.keys(on)
    onKeys.forEach(function(key) {
      if (on[key].split){
        on[key] = new Function("event", scopeVaribles(on[key], "this", variables)).bind(self)
      }
    })
    window.loads.push(on["load"])
    delete on["load"]
    attributes.on = on
    return attributes
  }
  
  function collectData(code) { return collectDataHelper(code, {}) }
  function collectDataHelper(code, collection) {
    if (!code || typeof code == "string") {
      return {}
    } else {
      dataKeys = Object.keys(code.attributes.data)
      dataKeys.forEach(function(key) {
        collection[key] = code.attributes.data[key]
      })
      code.children = code.children || []
      code.children.forEach(function(child) {
        collectDataHelper(child, collection)
      })
      return collection
    }
  }
  
  var app
  function run(){
    var data = collectData(window.code)
    if (window.code){
       app = new Vue({
        el: '#page',
        render: parseCodeToVueRender(window.code, Object.keys(data)),
        data: data,
        mounted: function () {
          this.$nextTick(function () {
            window.loads.forEach(function(func) { func && func() })
          })
        }
      // props: {
      //    
      //   }
      })
    }
  }

  setTimeout(run, 100  ) // timeout to wait for code to be defined on scope
</script>